<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat - ComuBus</title>
  <link rel="stylesheet" href="/static/css/tela_6.css" /> 
  
</head>
<body>
  <div class="container">
    <header>Linha T1 - Chat ComunitÃ¡rio</header>

    <div class="messages" id="messages">
      <!-- mensagens irÃ£o aqui -->
    </div>

    <div class="input-area">
      <textarea id="inputMessage" placeholder="Digite sua mensagem..."></textarea>

      <label title="Enviar foto ğŸ“·" for="inputPhoto">ğŸ“·
        <input type="file" id="inputPhoto" accept="image/*" />
      </label>

      <button class="location-btn" title="Enviar localizaÃ§Ã£o ğŸ“" id="btnLocation">ğŸ“</button>
      
      <button id="btnSend" title="Enviar mensagem">â¡ï¸</button>
    </div>
  </div>

  <script>
    const messagesDiv = document.getElementById('messages');
    const inputMessage = document.getElementById('inputMessage');
    const inputPhoto = document.getElementById('inputPhoto');
    const btnSend = document.getElementById('btnSend');
    const btnLocation = document.getElementById('btnLocation');

    // SimulaÃ§Ã£o de mensagens (com tags e votos)
    let messages = [
      {
        id: 1,
        author: 'JoÃ£o',
        text: 'Ã”nibus lotado na parada do Menino Deus.',
        reputation: 4,
        tags: ['urgente'],
        votes: { like: 5, dislike: 1 }
      },
      {
        id: 2,
        author: 'Maria',
        text: 'Acidente na Av. ProtÃ¡sio Alves causa atraso.',
        reputation: 3,
        tags: ['Ãºtil'],
        votes: { like: 8, dislike: 0 }
      },
      {
        id: 3,
        author: 'Carlos',
        text: 'InformaÃ§Ã£o falsa sobre engarrafamento, cuidado!',
        reputation: 2,
        tags: ['fake'],
        votes: { like: 1, dislike: 10 }
      }
    ];

    // FunÃ§Ã£o para renderizar mensagens
    function renderMessages() {
      messagesDiv.innerHTML = '';
      messages.forEach(msg => {
        const msgDiv = document.createElement('div');
        msgDiv.className = 'message';

        const author = document.createElement('div');
        author.className = 'author';
        author.textContent = `${msg.author} (ReputaÃ§Ã£o: ${msg.reputation})`;

        const text = document.createElement('div');
        text.className = 'text';
        text.textContent = msg.text;

        const meta = document.createElement('div');
        meta.className = 'meta';

        // Tags
        const tagsDiv = document.createElement('div');
        tagsDiv.className = 'tags';
        if(msg.tags.includes('urgente')) {
          const btn = criarTagBotao('Urgente', 'urgent', () => marcarTag(msg.id, 'urgente'));
          tagsDiv.appendChild(btn);
        } 
        if(msg.tags.includes('Ãºtil')) {
          const btn = criarTagBotao('Ãštil', 'useful', () => marcarTag(msg.id, 'Ãºtil'));
          tagsDiv.appendChild(btn);
        } 
        if(msg.tags.includes('fake')) {
          const btn = criarTagBotao('Fake', 'fake', () => marcarTag(msg.id, 'fake'));
          tagsDiv.appendChild(btn);
        }

        // Se mensagem nÃ£o tem alguma tag, mostrar botÃ£o para adicionar (pra simplificar, sÃ³ um por vez)
        ['urgente', 'Ãºtil', 'fake'].forEach(tag => {
          if(!msg.tags.includes(tag)) {
            const btn = criarTagBotao(`Marcar como ${tag}`, tag, () => marcarTag(msg.id, tag));
            tagsDiv.appendChild(btn);
          }
        });

        // VotaÃ§Ã£o
        const voteDiv = document.createElement('div');
        voteDiv.className = 'vote';
        voteDiv.innerHTML = `
          ğŸ‘ ${msg.votes.like} 
          <button onclick="votar(${msg.id}, 'like')">ğŸ‘</button>
          ğŸ‘ ${msg.votes.dislike} 
          <button onclick="votar(${msg.id}, 'dislike')">ğŸ‘</button>
        `;

        meta.appendChild(tagsDiv);
        meta.appendChild(voteDiv);

        msgDiv.appendChild(author);
        msgDiv.appendChild(text);
        msgDiv.appendChild(meta);

        messagesDiv.appendChild(msgDiv);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Cria botÃ£o de tag
    function criarTagBotao(texto, classe, onClick) {
      const btn = document.createElement('button');
      btn.className = `tag-btn ${classe}`;
      btn.textContent = texto;
      btn.onclick = () => {
        onClick();
        renderMessages();
      };
      return btn;
    }

    // Marca tag na mensagem (simples toggle)
    function marcarTag(id, tag) {
      const msg = messages.find(m => m.id === id);
      if (!msg) return;
      if (msg.tags.includes(tag)) {
        // Remove tag
        msg.tags = msg.tags.filter(t => t !== tag);
      } else {
        // Adiciona tag
        msg.tags.push(tag);
      }
    }

    // FunÃ§Ã£o de votaÃ§Ã£o
    function votar(id, tipo) {
      const msg = messages.find(m => m.id === id);
      if (!msg) return;
      if (tipo === 'like') msg.votes.like++;
      else if (tipo === 'dislike') msg.votes.dislike++;
      renderMessages();
    }

    // Envio da mensagem
    btnSend.addEventListener('click', () => {
      const texto = inputMessage.value.trim();
      if (!texto && !inputPhoto.files.length) {
        alert('Digite uma mensagem ou envie uma foto!');
        return;
      }

      let novaMsg = {
        id: messages.length + 1,
        author: 'VocÃª',
        text: texto,
        reputation: 5,
        tags: [],
        votes: { like: 0, dislike: 0 }
      };

      // Se enviou foto, adiciona texto com link fictÃ­cio
      if(inputPhoto.files.length) {
        const fileName = inputPhoto.files[0].name;
        novaMsg.text += novaMsg.text ? `\nğŸ“· Foto: ${fileName}` : `ğŸ“· Foto: ${fileName}`;
      }

      messages.push(novaMsg);
      inputMessage.value = '';
      inputPhoto.value = '';
      renderMessages();
    });

    // Enviar localizaÃ§Ã£o
    btnLocation.addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert('GeolocalizaÃ§Ã£o nÃ£o suportada pelo navegador.');
        return;
      }
      navigator.geolocation.getCurrentPosition(position => {
        const { latitude, longitude } = position.coords;
        let novaMsg = {
          id: messages.length + 1,
          author: 'VocÃª',
          text: `ğŸ“ LocalizaÃ§Ã£o: https://maps.google.com/?q=${latitude},${longitude}`,
          reputation: 5,
          tags: [],
          votes: { like: 0, dislike: 0 }
        };
        messages.push(novaMsg);
        renderMessages();
      }, () => alert('NÃ£o foi possÃ­vel obter a localizaÃ§Ã£o.'));
    });

    renderMessages();
  </script>
</body>
</html>
